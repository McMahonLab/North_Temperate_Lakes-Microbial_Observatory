library(OTUtable)
data(metadata)
metalakes <- substr(metadata$Sample_Name, start=1, stop=3)
metayears <- substr(metadata$Sample_Name, start=9, stop=10)
metaTBH <- metadata[which(metalakes == "TBH"), c(1,2,3)]
metaTBH <- dcast(metaTBH, Sample_Name~Depth, fun.aggregate=mean)
metaNSH <- metadata[which(metalakes == "NSH"), c(1,2,3)]
metaNSH <- dcast(metaNSH, Sample_Name~Depth, fun.aggregate=mean)
library(reshape2)
metaTBH <- dcast(metaTBH, Sample_Name~Depth, fun.aggregate=mean)
metaNSH <- metadata[which(metalakes == "NSH"), c(1,2,3)]
metaNSH <- dcast(metaNSH, Sample_Name~Depth, fun.aggregate=mean)
metaMAH <- metadata[which(metalakes == "MAH"), c(1,2,3)]
metaMAH <- dcast(metaMAH, Sample_Name~Depth, fun.aggregate=mean)
TBHdates <- extract_date(metaTBH$Sample_Name)
NSHdates <- extract_date(metaNSH$Sample_Name)
MAHdates <- extract_date(metaMAH$Sample_Name)
cont.mixes <- c()
for(i in 1:dim(plot.conn)[1]){
if(plot.conn$Lake[i] == "TBH"){
sample <- metaTBH[which(TBHdates == plot.conn$Date[i]),]
sample <- sample[2:length(sample)]
sample <- as.numeric(sample[which(is.na(sample) == F)])
cont.mixes[i] <- sample[3] - min(sample)
}else if(plot.conn$Lake[i] == "NSH"){
sample <- metaNSH[which(NSHdates == plot.conn$Date[i]),]
sample <- sample[2:length(sample)]
sample <- as.numeric(sample[which(is.na(sample) == F)])
cont.mixes[i] <- sample[3] - min(sample)
}else if(plot.conn$Lake[i] == "MAH"){
sample <- metaMAH[which(MAHdates == plot.conn$Date[i]),]
sample <- sample[2:length(sample)]
sample <- as.numeric(sample[which(is.na(sample) == F)])
cont.mixes[i] <- sample[3] - min(sample)
}
}
i=1
sample <- metaTBH[which(TBHdates == plot.conn$Date[i]),]
head(metaTBH)
data(otu_table)
data(taxonomy)
all.network <- read.table(file = "C:/Users/amlinz16/Desktop/North_Temperate_Lakes-Microbial_Observatory/Network_analysis/allsamples_network_28Jan16.txt", header = T)
all.edges <- table(c(as.character(all.network$index1), as.character(all.network$index2)))
TBH <- bog_subset("TBH", otu_table)
NSH <- bog_subset("NSH", otu_table)
MAH <- bog_subset("MAH", otu_table)
# Calcuate connectivity metric for each sample by lake
# metric (for each sample) = sum(OTU abundance * # of connections to that OTU * average strength of connections to that OTU)
TBH.nodes <- match(names(all.edges), rownames(TBH))
TBH.conn <- TBH[TBH.nodes,]
TBH.edges <- all.edges[match(rownames(TBH.conn), names(all.edges))]
TBH.corr <- c()
for(i in 1:length(TBH.edges)){
hits <- which(all.network$index1 == names(TBH.edges)[i] | all.network$index2 == names(TBH.edges)[i])
TBH.corr[i] <- mean(all.network$LSA[hits])
}
TBH.quant <- TBH.edges * TBH.corr
TBH.metric <- colSums(sweep(TBH.conn, 1, TBH.quant, "*"))
TBH.dates <- extract_date(colnames(TBH))
NSH.nodes <- match(names(all.edges), rownames(NSH))
NSH.conn <- NSH[NSH.nodes,]
NSH.edges <- all.edges[match(rownames(NSH.conn), names(all.edges))]
NSH.corr <- c()
for(i in 1:length(NSH.edges)){
hits <- which(all.network$index1 == names(NSH.edges)[i] | all.network$index2 == names(NSH.edges)[i])
NSH.corr[i] <- mean(all.network$LSA[hits])
}
NSH.quant <- NSH.edges * NSH.corr
NSH.metric <- colSums(sweep(NSH.conn, 1, NSH.quant, "*"))
NSH.dates <- extract_date(colnames(NSH))
MAH.nodes <- match(names(all.edges), rownames(MAH))
MAH.conn <- MAH[MAH.nodes,]
MAH.edges <- all.edges[match(rownames(MAH.conn), names(all.edges))]
MAH.corr <- c()
for(i in 1:length(MAH.edges)){
hits <- which(all.network$index1 == names(MAH.edges)[i] | all.network$index2 == names(MAH.edges)[i])
MAH.corr[i] <- mean(all.network$LSA[hits])
}
MAH.quant <- MAH.edges * MAH.corr
MAH.metric <- colSums(sweep(MAH.conn, 1, MAH.quant, "*"))
MAH.dates <- extract_date(colnames(MAH))
metalakes <- substr(metadata$Sample_Name, start=1, stop=3)
metayears <- substr(metadata$Sample_Name, start=9, stop=10)
metaTBH <- metadata[which(metalakes == "TBH"), c(1,2,3)]
metaTBH <- dcast(metaTBH, Sample_Name~Depth, fun.aggregate=mean)
metaNSH <- metadata[which(metalakes == "NSH"), c(1,2,3)]
metaNSH <- dcast(metaNSH, Sample_Name~Depth, fun.aggregate=mean)
metaMAH <- metadata[which(metalakes == "MAH"), c(1,2,3)]
metaMAH <- dcast(metaMAH, Sample_Name~Depth, fun.aggregate=mean)
TBHdates <- extract_date(metaTBH$Sample_Name)
NSHdates <- extract_date(metaNSH$Sample_Name)
MAHdates <- extract_date(metaMAH$Sample_Name)
cont.mixes <- c()
for(i in 1:dim(plot.conn)[1]){
if(plot.conn$Lake[i] == "TBH"){
sample <- metaTBH[which(TBHdates == plot.conn$Date[i]),]
sample <- sample[2:length(sample)]
sample <- as.numeric(sample[which(is.na(sample) == F)])
cont.mixes[i] <- sample[3] - min(sample)
}else if(plot.conn$Lake[i] == "NSH"){
sample <- metaNSH[which(NSHdates == plot.conn$Date[i]),]
sample <- sample[2:length(sample)]
sample <- as.numeric(sample[which(is.na(sample) == F)])
cont.mixes[i] <- sample[3] - min(sample)
}else if(plot.conn$Lake[i] == "MAH"){
sample <- metaMAH[which(MAHdates == plot.conn$Date[i]),]
sample <- sample[2:length(sample)]
sample <- as.numeric(sample[which(is.na(sample) == F)])
cont.mixes[i] <- sample[3] - min(sample)
}
}
plot.conn$Mixing.cont <- cont.mixes
# Add year and Julian Date variables
year <- substr(plot.conn$Date, start=1, stop=4)
plot.conn$Year<- factor(year, levels=c("2005", "2007", "2008", "2009"))
all.metric <- c(TBH.metric, NSH.metric, MAH.metric)
all.dates <- c(TBH.dates, NSH.dates, MAH.dates)
lakekey <- c(rep("TBH", length(TBH.metric)), rep("NSH", length(NSH.metric)), rep("MAH", length(MAH.metric)))
plot.conn <- data.frame(lakekey, all.dates, all.metric)
colnames(plot.conn) <- c("Lake", "Date", "Connectivity")
metalakes <- substr(metadata$Sample_Name, start=1, stop=3)
metayears <- substr(metadata$Sample_Name, start=9, stop=10)
metaTBH <- metadata[which(metalakes == "TBH"), c(1,2,3)]
metaTBH <- dcast(metaTBH, Sample_Name~Depth, fun.aggregate=mean)
metaNSH <- metadata[which(metalakes == "NSH"), c(1,2,3)]
metaNSH <- dcast(metaNSH, Sample_Name~Depth, fun.aggregate=mean)
metaMAH <- metadata[which(metalakes == "MAH"), c(1,2,3)]
metaMAH <- dcast(metaMAH, Sample_Name~Depth, fun.aggregate=mean)
TBHdates <- extract_date(metaTBH$Sample_Name)
NSHdates <- extract_date(metaNSH$Sample_Name)
MAHdates <- extract_date(metaMAH$Sample_Name)
cont.mixes <- c()
for(i in 1:dim(plot.conn)[1]){
if(plot.conn$Lake[i] == "TBH"){
sample <- metaTBH[which(TBHdates == plot.conn$Date[i]),]
sample <- sample[2:length(sample)]
sample <- as.numeric(sample[which(is.na(sample) == F)])
cont.mixes[i] <- sample[3] - min(sample)
}else if(plot.conn$Lake[i] == "NSH"){
sample <- metaNSH[which(NSHdates == plot.conn$Date[i]),]
sample <- sample[2:length(sample)]
sample <- as.numeric(sample[which(is.na(sample) == F)])
cont.mixes[i] <- sample[3] - min(sample)
}else if(plot.conn$Lake[i] == "MAH"){
sample <- metaMAH[which(MAHdates == plot.conn$Date[i]),]
sample <- sample[2:length(sample)]
sample <- as.numeric(sample[which(is.na(sample) == F)])
cont.mixes[i] <- sample[3] - min(sample)
}
}
plot.conn$Mixing.cont <- cont.mixes
# Add year and Julian Date variables
year <- substr(plot.conn$Date, start=1, stop=4)
plot.conn$Year<- factor(year, levels=c("2005", "2007", "2008", "2009"))
julian <- c()
for(i in 1:dim(plot.conn)[1]){
if(year[i] == "2005"){
julian[i] <- as.numeric(plot.conn$Date[i] - extract_date(c("TBH01Jun05")))
}else if(year[i] == "2007"){
julian[i] <- as.numeric(plot.conn$Date[i] - extract_date(c("TBH01Jun07")))
}else if(year[i] == "2008"){
julian[i] <- as.numeric(plot.conn$Date[i] - extract_date(c("TBH01Jun08")))
}else if(year[i] == "2009"){
julian[i] <- as.numeric(plot.conn$Date[i] - extract_date(c("TBH01Jun09")))
}
}
plot.conn$DayNum <- julian
# Run linear model
# Setup: Taking log transformed connectivity (+1 to avoid issues with 0) is determined by the year, the lake, and the interaction of the Julian date and the continuous mixing variable ()
model <- lm(log(Connectivity+1) ~Year + Lake + Mixing.cont*DayNum, data=plot.conn[which(plot.conn$DayNum >= 0),])
# Run model without interaction to see main effects
#summary(lm(log(Connectivity+1) ~Year + Lake + Mixing.cont+DayNum, data=plot.conn[which(plot.conn$DayNum >= 0),]))
summary(model)
x <- bog_subset("05", otu_table)
x <- year_subset("05", otu_table)
y <- bog_subset("MAH", x)
dim(y)
y <- bog_subset("TBH", x)
dim(y)
y <- bog_subset("NSH", x)
dim(y)
x <- year_subset("07", otu_table)
y <- bog_subset("MAH", x)
dim(y)
y <- bog_subset("TBH", x)
dim(y)
y <- bog_subset("NSH", x)
dim(y)
x <- year_subset("08", otu_table)
y <- bog_subset("MAH", x)
dim(y)
y <- bog_subset("TBH", x)
dim(y)
y <- bog_subset("NSH", x)
dim(y)
x <- year_subset("09", otu_table)
y <- bog_subset("MAH", x)
dim(y)
y <- bog_subset("TBH", x)
dim(y)
y <- bog_subset("NSH", x)
dim(y)
library(ggplot2)
citation(ggplot2)
citation("ggplot2")
