to.plot <- data.frame(abundance, persistence, variance)
to.plot$clade <- rownames(reduce_names(table))
z <- ggplot(data = to.plot, aes(x = variance, y = abundance/2500, fill = persistence)) + geom_point() + theme_bw() + labs(title = paste(lakes[i]), x = "Variability (CV)", y = "Mean Abundance when Present") + geom_label_repel(aes(label = clade), size = 2, force = 4, box.padding = unit(0.1, "lines")) + scale_fill_gradient(low = "white", high = "lightgreen")
assign(paste("p", i, sep = ""), z)
}
pdf(file = "C:/Users/Alex/Desktop/North_Temperate_Lakes-Microbial_Observatory/Plots/figure5.pdf", width = 3.3125*3, height = 9)
multiplot(p1, p2, p3, p4, cols = 2)
dev.off()
for(i in 1:length(lakes)){
table <- bog_subset(lakes[i], clades)
#Remove clades with very few reads
table <- table[which(rowSums(table) > 200),]
abundance <- c()
persistence <- c()
variance <- c()
for(j in 1:dim(table)[1]){
row <- table[j, ]
abundance[j] <- sum(row[which(row > 0)])/length(which(row > 0))
persistence[j] <- length(which(row > 0))/length(row)
variance[j] <- cv(as.numeric(row))
}
to.plot <- data.frame(abundance, persistence, variance)
to.plot$clade <- rownames(reduce_names(table))
z <- ggplot(data = to.plot, aes(x = variance, y = abundance/2500, fill = persistence)) + geom_point() + theme_bw() + labs(title = paste(lakes[i]), x = "Variability (CV)", y = "Mean Abundance when Present") + geom_label_repel(aes(label = clade), size = 2, force = 6, box.padding = unit(0.1, "lines")) + scale_fill_gradient(low = "white", high = "lightgreen")
assign(paste("p", i, sep = ""), z)
}
pdf(file = "C:/Users/Alex/Desktop/North_Temperate_Lakes-Microbial_Observatory/Plots/figure5.pdf", width = 3.3125*3, height = 9)
multiplot(p1, p2, p3, p4, cols = 2)
dev.off()
for(i in 1:length(lakes)){
table <- bog_subset(lakes[i], clades)
#Remove clades with very few reads
table <- table[which(rowSums(table) > 200),]
abundance <- c()
persistence <- c()
variance <- c()
for(j in 1:dim(table)[1]){
row <- table[j, ]
abundance[j] <- sum(row[which(row > 0)])/length(which(row > 0))
persistence[j] <- length(which(row > 0))/length(row)
variance[j] <- cv(as.numeric(row))
}
to.plot <- data.frame(abundance, persistence, variance)
to.plot$clade <- rownames(reduce_names(table))
z <- ggplot(data = to.plot, aes(x = variance, y = abundance/2500, fill = persistence)) + geom_point() + theme_bw() + labs(title = paste(lakes[i]), x = "Variability (CV)", y = "Mean Abundance when Present") + geom_label_repel(aes(label = clade), size = 2, force = 7, box.padding = unit(0.1, "lines")) + scale_fill_gradient(low = "white", high = "lightgreen")
assign(paste("p", i, sep = ""), z)
}
pdf(file = "C:/Users/Alex/Desktop/North_Temperate_Lakes-Microbial_Observatory/Plots/figure5.pdf", width = 3.3125*3, height = 9)
multiplot(p1, p2, p3, p4, cols = 2)
dev.off()
for(i in 1:length(lakes)){
table <- bog_subset(lakes[i], clades)
#Remove clades with very few reads
table <- table[which(rowSums(table) > 200),]
abundance <- c()
persistence <- c()
variance <- c()
for(j in 1:dim(table)[1]){
row <- table[j, ]
abundance[j] <- sum(row[which(row > 0)])/length(which(row > 0))
persistence[j] <- length(which(row > 0))/length(row)
variance[j] <- cv(as.numeric(row))
}
to.plot <- data.frame(abundance, persistence, variance)
to.plot$clade <- rownames(reduce_names(table))
z <- ggplot(data = to.plot, aes(x = variance, y = abundance/2500, fill = persistence)) + geom_point() + theme_bw() + labs(title = paste(lakes[i]), x = "Variability (CV)", y = "Mean Abundance when Present") + geom_label_repel(aes(label = clade), size = 2, force = 10, box.padding = unit(0.075, "lines")) + scale_fill_gradient(low = "white", high = "lightgreen")
assign(paste("p", i, sep = ""), z)
}
pdf(file = "C:/Users/Alex/Desktop/North_Temperate_Lakes-Microbial_Observatory/Plots/figure5.pdf", width = 3.3125*3, height = 9)
multiplot(p1, p2, p3, p4, cols = 2)
dev.off()
for(i in 1:length(lakes)){
table <- bog_subset(lakes[i], clades)
#Remove clades with very few reads
table <- table[which(rowSums(table) > 200),]
abundance <- c()
persistence <- c()
variance <- c()
for(j in 1:dim(table)[1]){
row <- table[j, ]
abundance[j] <- sum(row[which(row > 0)])/length(which(row > 0))
persistence[j] <- length(which(row > 0))/length(row)
variance[j] <- cv(as.numeric(row))
}
to.plot <- data.frame(abundance, persistence, variance)
to.plot$clade <- rownames(reduce_names(table))
z <- ggplot(data = to.plot, aes(x = variance, y = abundance/2500, fill = persistence)) + geom_point() + theme_bw() + labs(title = paste(lakes[i]), x = "Variability (CV)", y = "Mean Abundance when Present") + geom_label_repel(aes(label = clade), size = 2, force = 12, box.padding = unit(0.01, "lines")) + scale_fill_gradient(low = "white", high = "lightgreen")
assign(paste("p", i, sep = ""), z)
}
pdf(file = "C:/Users/Alex/Desktop/North_Temperate_Lakes-Microbial_Observatory/Plots/figure5.pdf", width = 3.3125*3, height = 9)
multiplot(p1, p2, p3, p4, cols = 2)
dev.off()
for(i in 1:length(lakes)){
table <- bog_subset(lakes[i], clades)
#Remove clades with very few reads
table <- table[which(rowSums(table) > 150),]
abundance <- c()
persistence <- c()
variance <- c()
for(j in 1:dim(table)[1]){
row <- table[j, ]
abundance[j] <- sum(row[which(row > 0)])/length(which(row > 0))
persistence[j] <- length(which(row > 0))/length(row)
variance[j] <- cv(as.numeric(row))
}
to.plot <- data.frame(abundance, persistence, variance)
to.plot$clade <- rownames(reduce_names(table))
z <- ggplot(data = to.plot, aes(x = variance, y = abundance/2500, fill = persistence)) + geom_point() + theme_bw() + labs(title = paste(lakes[i]), x = "Variability (CV)", y = "Mean Abundance when Present") + geom_label_repel(aes(label = clade), size = 2, force = 12, box.padding = unit(0.01, "lines")) + scale_fill_gradient(low = "white", high = "lightgreen")
assign(paste("p", i, sep = ""), z)
}
pdf(file = "C:/Users/Alex/Desktop/North_Temperate_Lakes-Microbial_Observatory/Plots/figure5.pdf", width = 3.3125*3, height = 9)
multiplot(p1, p2, p3, p4, cols = 2)
dev.off()
for(i in 1:length(lakes)){
table <- bog_subset(lakes[i], clades)
#Remove clades with very few reads
if(i = 4){
table <- table[which(rowSums(table) > 300),]
}else{
table <- table[which(rowSums(table) > 10),]
}
abundance <- c()
persistence <- c()
variance <- c()
for(j in 1:dim(table)[1]){
row <- table[j, ]
abundance[j] <- sum(row[which(row > 0)])/length(which(row > 0))
persistence[j] <- length(which(row > 0))/length(row)
variance[j] <- cv(as.numeric(row))
}
to.plot <- data.frame(abundance, persistence, variance)
to.plot$clade <- rownames(reduce_names(table))
z <- ggplot(data = to.plot, aes(x = variance, y = abundance/2500, fill = persistence)) + geom_point() + theme_bw() + labs(title = paste(lakes[i]), x = "Variability (CV)", y = "Mean Abundance when Present") + geom_label_repel(aes(label = clade), size = 2, force = 12, box.padding = unit(0.01, "lines")) + scale_fill_gradient(low = "white", high = "lightgreen")
assign(paste("p", i, sep = ""), z)
}
pdf(file = "C:/Users/Alex/Desktop/North_Temperate_Lakes-Microbial_Observatory/Plots/figure5.pdf", width = 3.3125*3, height = 9)
multiplot(p1, p2, p3, p4, cols = 2)
dev.off()
for(i in 1:length(lakes)){
table <- bog_subset(lakes[i], clades)
#Remove clades with very few reads
if(i == 4){
table <- table[which(rowSums(table) > 300),]
}else{
table <- table[which(rowSums(table) > 10),]
}
abundance <- c()
persistence <- c()
variance <- c()
for(j in 1:dim(table)[1]){
row <- table[j, ]
abundance[j] <- sum(row[which(row > 0)])/length(which(row > 0))
persistence[j] <- length(which(row > 0))/length(row)
variance[j] <- cv(as.numeric(row))
}
to.plot <- data.frame(abundance, persistence, variance)
to.plot$clade <- rownames(reduce_names(table))
z <- ggplot(data = to.plot, aes(x = variance, y = abundance/2500, fill = persistence)) + geom_point() + theme_bw() + labs(title = paste(lakes[i]), x = "Variability (CV)", y = "Mean Abundance when Present") + geom_label_repel(aes(label = clade), size = 2, force = 12, box.padding = unit(0.01, "lines")) + scale_fill_gradient(low = "white", high = "lightgreen")
assign(paste("p", i, sep = ""), z)
}
pdf(file = "C:/Users/Alex/Desktop/North_Temperate_Lakes-Microbial_Observatory/Plots/figure5.pdf", width = 3.3125*3, height = 9)
multiplot(p1, p2, p3, p4, cols = 2)
dev.off()
for(i in 1:length(lakes)){
table <- bog_subset(lakes[i], clades)
#Remove clades with very few reads
if(i == 4){
table <- table[which(rowSums(table) > 400),]
}else{
table <- table[which(rowSums(table) > 10),]
}
abundance <- c()
persistence <- c()
variance <- c()
for(j in 1:dim(table)[1]){
row <- table[j, ]
abundance[j] <- sum(row[which(row > 0)])/length(which(row > 0))
persistence[j] <- length(which(row > 0))/length(row)
variance[j] <- cv(as.numeric(row))
}
to.plot <- data.frame(abundance, persistence, variance)
to.plot$clade <- rownames(reduce_names(table))
z <- ggplot(data = to.plot, aes(x = variance, y = abundance/2500, fill = persistence)) + geom_point() + theme_bw() + labs(title = paste(lakes[i]), x = "Variability (CV)", y = "Mean Abundance when Present") + geom_label_repel(aes(label = clade), size = 3, force = 12, box.padding = unit(0.01, "lines")) + scale_fill_gradient(low = "white", high = "lightgreen")
assign(paste("p", i, sep = ""), z)
}
pdf(file = "C:/Users/Alex/Desktop/North_Temperate_Lakes-Microbial_Observatory/Plots/figure5.pdf", width = 3.3125*3, height = 9)
multiplot(p1, p2, p3, p4, cols = 2)
dev.off()
for(i in 1:length(lakes)){
table <- bog_subset(lakes[i], clades)
#Remove clades with very few reads
if(i == 4){
table <- table[which(rowSums(table) > 400),]
}else{
table <- table[which(rowSums(table) > 10),]
}
abundance <- c()
persistence <- c()
variance <- c()
for(j in 1:dim(table)[1]){
row <- table[j, ]
abundance[j] <- sum(row[which(row > 0)])/length(which(row > 0))
persistence[j] <- length(which(row > 0))/length(row)
variance[j] <- cv(as.numeric(row))
}
to.plot <- data.frame(abundance, persistence, variance)
to.plot$clade <- rownames(reduce_names(table))
z <- ggplot(data = to.plot, aes(x = variance, y = abundance/2500, fill = persistence)) + geom_point() + theme_bw() + labs(title = paste(lakes[i]), x = "Variability (CV)", y = "Mean Abundance when Present") + geom_label_repel(aes(label = clade), size = 2, force = 12, box.padding = unit(0.01, "lines")) + scale_fill_gradient(low = "white", high = "lightgreen")
assign(paste("p", i, sep = ""), z)
}
pdf(file = "C:/Users/Alex/Desktop/North_Temperate_Lakes-Microbial_Observatory/Plots/figure5.pdf", width = 3.3125*3, height = 9)
multiplot(p1, p2, p3, p4, cols = 2)
dev.off()
year <- c("05", "07", "08", "09")
for(i in 1:length(year)){
table <- bog_subset("TBH", clades)
table <- year_subset(year[i], table)
table <- table[which(rowSums(table) > 10),]
abundance <- c()
variance <- c()
persistance <- c()
for(j in 1:dim(table)[1]){
row <- table[j, ]
persistance[j] <- length(which(row > 0))/length(row)
if(sum(row) > 0){
variance[j] <- cv(as.numeric(row))
abundance[j] <- sum(row[which(row > 0)])/length(which(row > 0))
}else{
variance[j] <- 0
abundance[j] <- 0
}
}
to.plot <- data.frame(abundance, persistance, variance)
to.plot$lineage <- rownames(reduce_names(table))
z <- ggplot(data = to.plot, aes(x = variance, y = abundance, fill = persistance)) + geom_point() + theme_bw() + labs(title = paste(year[i]), x = "Variability (CV)", y = "Mean Abundance when Present") + geom_label_repel(aes(label = lineage)) + scale_fill_gradient(low = "white", high = "lightgreen") + theme(legend.position = "none")
assign(paste("p", i, sep = ""), z)
}
multiplot(p1, p2, p3, p4, cols = 2)
pdf(file = "C:/Users/Alex/Desktop/North_Temperate_Lakes-Microbial_Observatory/Plots/figureS7.pdf", width = 3.3125*2, height = 7)
multiplot(p1, p2, p3, p4, cols = 2)
dev.off()
year <- c("05", "07", "08", "09")
for(i in 1:length(year)){
table <- bog_subset("TBH", clades)
table <- year_subset(year[i], table)
table <- table[which(rowSums(table) > 10),]
abundance <- c()
variance <- c()
persistance <- c()
for(j in 1:dim(table)[1]){
row <- table[j, ]
persistance[j] <- length(which(row > 0))/length(row)
if(sum(row) > 0){
variance[j] <- cv(as.numeric(row))
abundance[j] <- sum(row[which(row > 0)])/length(which(row > 0))
}else{
variance[j] <- 0
abundance[j] <- 0
}
}
to.plot <- data.frame(abundance, persistance, variance)
to.plot$lineage <- rownames(reduce_names(table))
z <- ggplot(data = to.plot, aes(x = variance, y = abundance/2500, fill = persistance)) + geom_point() + theme_bw() + labs(title = paste(years[i]), x = "Variability (CV)", y = "Mean Abundance when Present") + geom_label_repel(aes(label = clade), size = 2, force = 12, box.padding = unit(0.01, "lines")) + scale_fill_gradient(low = "white", high = "lightgreen")
assign(paste("p", i, sep = ""), z)
}
pdf(file = "C:/Users/Alex/Desktop/North_Temperate_Lakes-Microbial_Observatory/Plots/figureS7.pdf", width = width = 3.3125*3, height = 9)
multiplot(p1, p2, p3, p4, cols = 2)
dev.off()
year <- c("05", "07", "08", "09")
for(i in 1:length(year)){
table <- bog_subset("TBH", clades)
table <- year_subset(year[i], table)
table <- table[which(rowSums(table) > 10),]
abundance <- c()
variance <- c()
persistance <- c()
for(j in 1:dim(table)[1]){
row <- table[j, ]
persistance[j] <- length(which(row > 0))/length(row)
if(sum(row) > 0){
variance[j] <- cv(as.numeric(row))
abundance[j] <- sum(row[which(row > 0)])/length(which(row > 0))
}else{
variance[j] <- 0
abundance[j] <- 0
}
}
to.plot <- data.frame(abundance, persistance, variance)
to.plot$lineage <- rownames(reduce_names(table))
z <- ggplot(data = to.plot, aes(x = variance, y = abundance/2500, fill = persistance)) + geom_point() + theme_bw() + labs(title = paste(year[i]), x = "Variability (CV)", y = "Mean Abundance when Present") + geom_label_repel(aes(label = clade), size = 2, force = 12, box.padding = unit(0.01, "lines")) + scale_fill_gradient(low = "white", high = "lightgreen")
assign(paste("p", i, sep = ""), z)
}
pdf(file = "C:/Users/Alex/Desktop/North_Temperate_Lakes-Microbial_Observatory/Plots/figureS7.pdf", width = 3.3125*3, height = 9)
multiplot(p1, p2, p3, p4, cols = 2)
dev.off()
year <- c("05", "07", "08", "09")
for(i in 1:length(year)){
table <- bog_subset("TBH", clades)
table <- year_subset(year[i], table)
table <- table[which(rowSums(table) > 10),]
abundance <- c()
variance <- c()
persistance <- c()
for(j in 1:dim(table)[1]){
row <- table[j, ]
persistance[j] <- length(which(row > 0))/length(row)
if(sum(row) > 0){
variance[j] <- cv(as.numeric(row))
abundance[j] <- sum(row[which(row > 0)])/length(which(row > 0))
}else{
variance[j] <- 0
abundance[j] <- 0
}
}
to.plot <- data.frame(abundance, persistance, variance)
to.plot$clade <- rownames(reduce_names(table))
z <- ggplot(data = to.plot, aes(x = variance, y = abundance/2500, fill = persistance)) + geom_point() + theme_bw() + labs(title = paste(year[i]), x = "Variability (CV)", y = "Mean Abundance when Present") + geom_label_repel(aes(label = clade), size = 2, force = 12, box.padding = unit(0.01, "lines")) + scale_fill_gradient(low = "white", high = "lightgreen")
assign(paste("p", i, sep = ""), z)
}
pdf(file = "C:/Users/Alex/Desktop/North_Temperate_Lakes-Microbial_Observatory/Plots/figureS7.pdf", width = 3.3125*3, height = 9)
multiplot(p1, p2, p3, p4, cols = 2)
dev.off()
seqs <- read.dna("C:/Users/Alex/Desktop/North_Temperate_Lakes-Microbial_Observatory/Data/16S_data/qc.bogs.clean.min25.fasta", format = "fasta")
d <- dist.dna(seqs, model = "raw")
bogtree <- nj(d)
library(ape)
seqs <- read.dna("C:/Users/Alex/Desktop/North_Temperate_Lakes-Microbial_Observatory/Data/16S_data/qc.bogs.clean.min25.fasta", format = "fasta")
d <- dist.dna(seqs, model = "raw")
bogtree <- nj(d)
OTU <- otu_table(as.matrix(seq_table), taxa_are_rows = T)
TAX <- tax_table(as.matrix(seq_taxonomy))
sampledata <- sample_data(data.frame(Bog = substr(colnames(seq_table), start = 1, stop = 2), Layer = substr(colnames(seq_table), start = 3, stop = 3), Year = substr(colnames(seq_table), start = 9, stop = 10), row.names = colnames(seq_table), stringsAsfactors = F))
alldata <- phyloseq(OTU, TAX, sampledata, bogtree)
TBH <- prune_samples(sampledata$Bog == "TB" & sampledata$Layer == "H", alldata)
x <- UniFrac(TBH, weighted = T, normalize = T)
x <- melt(as.matrix(x))
x$Date <- as.numeric(abs(extract_date(x$Var1) - extract_date(x$Var2)))
p1 <- ggplot(x, aes(x = Date, y = value)) + geom_point(size = 0.5, alpha = 1/10) + theme_bw() + labs(title = "Trout Bog Hypolimnion", x = "Time Difference", y = "UniFrac Distance") + scale_x_continuous(breaks = c(365, 365*2, 365*3, 365*4))
library(OTUtable)
library(phyloseq)
OTU <- otu_table(as.matrix(seq_table), taxa_are_rows = T)
TAX <- tax_table(as.matrix(seq_taxonomy))
sampledata <- sample_data(data.frame(Bog = substr(colnames(seq_table), start = 1, stop = 2), Layer = substr(colnames(seq_table), start = 3, stop = 3), Year = substr(colnames(seq_table), start = 9, stop = 10), row.names = colnames(seq_table), stringsAsfactors = F))
alldata <- phyloseq(OTU, TAX, sampledata, bogtree)
# Select lake and layer, then calculate UniFrac and plot vs time difference
TBH <- prune_samples(sampledata$Bog == "TB" & sampledata$Layer == "H", alldata)
x <- UniFrac(TBH, weighted = T, normalize = T)
x <- melt(as.matrix(x))
x$Date <- as.numeric(abs(extract_date(x$Var1) - extract_date(x$Var2)))
p1 <- ggplot(x, aes(x = Date, y = value)) + geom_point(size = 0.5, alpha = 1/10) + theme_bw() + labs(title = "Trout Bog Hypolimnion", x = "Time Difference", y = "UniFrac Distance") + scale_x_continuous(breaks = c(365, 365*2, 365*3, 365*4))
head(x)
x$Mon1 <- substr(x$Var1, start = 6, stop = 8)
x$Mon2 <- substr(x$Var2, start = 6, stop = 8)
head(x)
dim(x)
colors <- rep("black", dim(x)[1])
colors <- rep("black", dim(x)[1])
colors[which(x$Mon1 == "NOV" & x$Mon2 == "NOV")] <- "blue"
p1 <- ggplot(x, aes(x = Date, y = value)) + geom_point(size = 0.5, alpha = 1/10, fill = colors) + theme_bw() + labs(title = "Trout Bog Hypolimnion", x = "Time Difference", y = "UniFrac Distance") + scale_x_continuous(breaks = c(365, 365*2, 365*3, 365*4))
p1
p1 <- ggplot(x, aes(x = Date, y = value)) + geom_point(size = 0.5, alpha = 1/10, color = colors) + theme_bw() + labs(title = "Trout Bog Hypolimnion", x = "Time Difference", y = "UniFrac Distance") + scale_x_continuous(breaks = c(365, 365*2, 365*3, 365*4))
p1
x[which(x$Date > 335 & x$Date < 395 & x$value < 0.6),]
x[which(x$Date > 335 & x$Date < 395 & x$value < 0.06),]
x[which(x$Date > 335 & x$Date < 395 & x$value < 0.05),]
hist(x[which(x$Date > 335 & x$Date < 395 & x$value < 0.06),4])
TBE <- prune_samples(sampledata$Bog == "TB" & sampledata$Layer == "E", alldata)
x <- UniFrac(TBE, weighted = T, normalize = T)
x <- melt(as.matrix(x))
x$Date <- as.numeric(abs(extract_date(x$Var1) - extract_date(x$Var2)))
hist(x[which(x$Date > 335 & x$Date < 395 & x$value < 0.06),4])
x[which(x$Date > 335 & x$Date < 395 & x$value < 0.06),4]
head(x)
x[which(x$Date > 335 & x$Date < 395),4]
hist(x[which(x$Date > 335 & x$Date < 395),4])
ggplot(x, aes(x = Date, y = value)) + geom_point(size = 0.5, alpha = 1/10) + theme_bw() + labs(title = "Trout Bog Epilimnion", x = "Time Difference", y = "UniFrac Distance") + scale_x_continuous(breaks = c(365, 365*2, 365*3, 365*4))
x[which(x$Date > 335 & x$Date < 395 & x$value < 0.1),4]
hist(x[which(x$Date > 335 & x$Date < 395 & x$value < 0.1),4])
x[which(x$Date > 335 & x$Date < 395 & x$value < 0.1),]
x$Mon1 <- substr(x$Var1, start = 6, stop = 8)
x$Mon2 <- substr(x$Var2, start = 6, stop = 8)
x[which(x$Date > 335 & x$Date < 395 & x$value < 0.1),]
p2 <- ggplot(x, aes(x = Date, y = value)) + geom_point(size = 0.5, alpha = 1/10) + theme_bw() + labs(title = "Trout Bog Epilimnion", x = "Time Difference", y = "UniFrac Distance") + scale_x_continuous(breaks = c(365, 365*2, 365*3, 365*4)) + geom_smooth()
p2
p2
TBH <- prune_samples(sampledata$Bog == "TB" & sampledata$Layer == "H", alldata)
x <- UniFrac(TBH, weighted = T, normalize = T)
x <- melt(as.matrix(x))
x$Date <- as.numeric(abs(extract_date(x$Var1) - extract_date(x$Var2)))
x$Mon1 <- substr(x$Var1, start = 6, stop = 8)
x$Mon2 <- substr(x$Var2, start = 6, stop = 8)
colors <- rep("black", dim(x)[1])
colors[which(x$Mon1 == "NOV" & x$Mon2 == "NOV")] <- "blue"
p1 <- ggplot(x, aes(x = Date, y = value)) + geom_point(size = 0.5, alpha = 1/10, color = colors) + theme_bw() + labs(title = "Trout Bog Hypolimnion", x = "Time Difference", y = "UniFrac Distance") + scale_x_continuous(breaks = c(365, 365*2, 365*3, 365*4)) + geom_smooth()
TBE <- prune_samples(sampledata$Bog == "TB" & sampledata$Layer == "E", alldata)
x <- UniFrac(TBE, weighted = T, normalize = T)
x <- melt(as.matrix(x))
x$Date <- as.numeric(abs(extract_date(x$Var1) - extract_date(x$Var2)))
x$Mon1 <- substr(x$Var1, start = 6, stop = 8)
x$Mon2 <- substr(x$Var2, start = 6, stop = 8)
colors <- rep("black", dim(x)[1])
colors[which(x$Mon1 == "NOV" & x$Mon2 == "NOV")] <- "blue"
p2 <- ggplot(x, aes(x = Date, y = value)) + geom_point(size = 0.5, alpha = 1/10) + theme_bw() + labs(title = "Trout Bog Epilimnion", x = "Time Difference", y = "UniFrac Distance") + scale_x_continuous(breaks = c(365, 365*2, 365*3, 365*4)) + geom_smooth()
MAH <- prune_samples(sampledata$Bog == "MA" & sampledata$Layer == "H", alldata)
x <- UniFrac(MAH, weighted = T, normalize = T)
x <- melt(as.matrix(x))
x$Date <- as.numeric(abs(extract_date(x$Var1) - extract_date(x$Var2)))
p3 <- ggplot(x, aes(x = Date, y = value)) + geom_point(size = 0.5, alpha = 1/10) + theme_bw() + labs(title = "Mary Lake Hypolimnion", x = "Time Difference", y = "UniFrac Distance") + scale_x_continuous(breaks = c(365, 365*2, 365*3, 365*4)) + geom_smooth()
pdf(file = "C:/Users/Alex/Desktop/North_Temperate_Lakes-Microbial_Observatory/Plots/figure3.pdf", width = 3.3125*2, height = 7)
multiplot(p1, p2, p3, cols = 1)
dev.off()
x[which(x$value < 0.35),]
x[which(x$value > 0.35),]
x[which(x$value > 0.37),]
x[which(x$value > 0.55),]
x[which(x$value > 0.6),]
x <- x[which(x$Var1 != "MAH23OCT07 &" x$Var1 != "MAH30JUL07" & x$Var2 != "MAH23OCT07 &" x$Var2 != "MAH30JUL07"),]
x <- x[which(x$Var1 != "MAH23OCT07" & x$Var1 != "MAH30JUL07" & x$Var2 != "MAH23OCT07" & x$Var2 != "MAH30JUL07"),]
p3 <- ggplot(x, aes(x = Date, y = value)) + geom_point(size = 0.5, alpha = 1/10) + theme_bw() + labs(title = "Mary Lake Hypolimnion", x = "Time Difference", y = "UniFrac Distance") + scale_x_continuous(breaks = c(365, 365*2, 365*3, 365*4)) + geom_smooth()
p3
x[which(x$value > 0.6),]
x <- x[which(x$Var1 != "MAH23OCT07.R1" & x$Var1 != "MAH30JUL07.R1" & x$Var2 != "MAH23OCT07.R1" & x$Var2 != "MAH30JUL07.R1" & x$Var1 != "MAH23OCT07.R2" & x$Var1 != "MAH30JUL07.R2" & x$Var2 != "MAH23OCT07.R2" & x$Var2 != "MAH30JUL07.R2"),]
p3 <- ggplot(x, aes(x = Date, y = value)) + geom_point(size = 0.5, alpha = 1/10) + theme_bw() + labs(title = "Mary Lake Hypolimnion", x = "Time Difference", y = "UniFrac Distance") + scale_x_continuous(breaks = c(365, 365*2, 365*3, 365*4)) + geom_smooth()
p3
x[which(x$value > 0.6),]
TBH <- prune_samples(sampledata$Bog == "TB" & sampledata$Layer == "H", alldata)
x <- UniFrac(TBH, weighted = T, normalize = T)
x <- melt(as.matrix(x))
x$Date <- as.numeric(abs(extract_date(x$Var1) - extract_date(x$Var2)))
x$Mon1 <- substr(x$Var1, start = 6, stop = 8)
x$Mon2 <- substr(x$Var2, start = 6, stop = 8)
colors <- rep("black", dim(x)[1])
colors[which(x$Mon1 == "NOV" & x$Mon2 == "NOV")] <- "blue"
p1 <- ggplot(x, aes(x = Date, y = value)) + geom_point(size = 0.5, alpha = 1/10, color = colors) + theme_bw() + labs(title = "Trout Bog Hypolimnion", x = "Time Difference", y = "UniFrac Distance") + scale_x_continuous(breaks = c(365, 365*2, 365*3, 365*4)) + geom_smooth()
TBE <- prune_samples(sampledata$Bog == "TB" & sampledata$Layer == "E", alldata)
x <- UniFrac(TBE, weighted = T, normalize = T)
x <- melt(as.matrix(x))
x$Date <- as.numeric(abs(extract_date(x$Var1) - extract_date(x$Var2)))
x$Mon1 <- substr(x$Var1, start = 6, stop = 8)
x$Mon2 <- substr(x$Var2, start = 6, stop = 8)
colors <- rep("black", dim(x)[1])
p2 <- ggplot(x, aes(x = Date, y = value)) + geom_point(size = 0.5, alpha = 1/10) + theme_bw() + labs(title = "Trout Bog Epilimnion", x = "Time Difference", y = "UniFrac Distance") + scale_x_continuous(breaks = c(365, 365*2, 365*3, 365*4)) + geom_smooth()
MAH <- prune_samples(sampledata$Bog == "MA" & sampledata$Layer == "H", alldata)
x <- UniFrac(MAH, weighted = T, normalize = T)
x <- melt(as.matrix(x))
x$Date <- as.numeric(abs(extract_date(x$Var1) - extract_date(x$Var2)))
x <- x[which(x$Var1 != "MAH23OCT07.R1" & x$Var1 != "MAH30JUL07.R1" & x$Var2 != "MAH23OCT07.R1" & x$Var2 != "MAH30JUL07.R1" & x$Var1 != "MAH23OCT07.R2" & x$Var1 != "MAH30JUL07.R2" & x$Var2 != "MAH23OCT07.R2" & x$Var2 != "MAH30JUL07.R2"),]
p3 <- ggplot(x, aes(x = Date, y = value)) + geom_point(size = 0.5, alpha = 1/10) + theme_bw() + labs(title = "Mary Lake Hypolimnion", x = "Time Difference", y = "UniFrac Distance") + scale_x_continuous(breaks = c(365, 365*2, 365*3, 365*4)) + geom_smooth()
pdf(file = "C:/Users/Alex/Desktop/North_Temperate_Lakes-Microbial_Observatory/Plots/figure3.pdf", width = 3.3125*2, height = 7)
multiplot(p1, p2, p3, cols = 1)
dev.off()
# Select lake and layer, then calculate UniFrac and plot vs time difference
NSH <- prune_samples(sampledata$Bog == "NS" & sampledata$Layer == "H", alldata)
x <- UniFrac(NSH, weighted = T, normalize = T)
x <- melt(as.matrix(x))
x$Date <- as.numeric(abs(extract_date(x$Var1) - extract_date(x$Var2)))
p1 <- ggplot(x, aes(x = Date, y = value)) + geom_point(size = 0.5, alpha = 1/10) + theme_bw() + labs(title = "North Sparkling Hypolimnion", x = "Time Difference", y = "UniFrac Distance") + scale_x_continuous(breaks = c(365, 365*2, 365*3, 365*4)) + geom_smooth()
NSE <- prune_samples(sampledata$Bog == "NS" & sampledata$Layer == "E", alldata)
x <- UniFrac(NSE, weighted = T, normalize = T)
x <- melt(as.matrix(x))
x$Date <- as.numeric(abs(extract_date(x$Var1) - extract_date(x$Var2)))
p2 <- ggplot(x, aes(x = Date, y = value)) + geom_point(size = 0.5, alpha = 1/10) + theme_bw() + labs(title = "North Sparkling Epilimnion", x = "Time Difference", y = "UniFrac Distance") + scale_x_continuous(breaks = c(365, 365*2, 365*3, 365*4)) + geom_smooth()
MAE <- prune_samples(sampledata$Bog == "MA" & sampledata$Layer == "E", alldata)
x <- UniFrac(MAE, weighted = T, normalize = T)
x <- melt(as.matrix(x))
x$Date <- as.numeric(abs(extract_date(x$Var1) - extract_date(x$Var2)))
p3 <- ggplot(x, aes(x = Date, y = value)) + geom_point(size = 0.5, alpha = 1/10) + theme_bw() + labs(title = "Mary Lake Epilimnion", x = "Time Difference", y = "UniFrac Distance") + scale_x_continuous(breaks = c(365, 365*2, 365*3, 365*4)) + geom_smooth()
pdf(file = "C:/Users/Alex/Desktop/North_Temperate_Lakes-Microbial_Observatory/Plots/figureS8.1.pdf", width = 3.3125*2, height = 7)
multiplot(p1, p2, p3, cols = 1)
dev.off()
SSH <- prune_samples(sampledata$Bog == "SS" & sampledata$Layer == "H", alldata)
x <- UniFrac(SSH, weighted = T, normalize = T)
x <- melt(as.matrix(x))
x$Date <- as.numeric(abs(extract_date(x$Var1) - extract_date(x$Var2)))
p1 <- ggplot(x, aes(x = Date, y = value)) + geom_point(size = 0.5, alpha = 1/10) + theme_bw() + labs(title = "South Sparkling Hypolimnion", x = "Time Difference", y = "UniFrac Distance") + scale_x_continuous(breaks = c(365, 365*2, 365*3, 365*4)) + geom_smooth()
SSE <- prune_samples(sampledata$Bog == "SS" & sampledata$Layer == "E", alldata)
x <- UniFrac(SSE, weighted = T, normalize = T)
x <- melt(as.matrix(x))
x$Date <- as.numeric(abs(extract_date(x$Var1) - extract_date(x$Var2)))
p2 <- ggplot(x, aes(x = Date, y = value)) + geom_point(size = 0.5, alpha = 1/10) + theme_bw() + labs(title = "South Sparkling Epilimnion", x = "Time Difference", y = "UniFrac Distance") + scale_x_continuous(breaks = c(365, 365*2, 365*3, 365*4)) + geom_smooth()
pdf(file = "C:/Users/Alex/Desktop/North_Temperate_Lakes-Microbial_Observatory/Plots/figureS8.2.pdf", width = 3.3125*2, height = 7/3*2)
multiplot(p1, p2, cols = 1)
dev.off()
p2
p1
multiplot(p1, p2, cols = 1)
pdf(file = "C:/Users/Alex/Desktop/North_Temperate_Lakes-Microbial_Observatory/Plots/figureS8.2.pdf", width = 3.3125*2, height = 7/3*2)
multiplot(p1, p2, cols = 1)
dev.off()
TBH <- prune_samples(sampledata$Bog == "TB" & sampledata$Layer == "H", alldata)
x <- UniFrac(TBH, weighted = T, normalize = T)
x <- melt(as.matrix(x))
x$Date <- as.numeric(abs(extract_date(x$Var1) - extract_date(x$Var2)))
colors[which(x$Mon1 == "NOV" & x$Mon2 == "NOV")] <- "blue"
p1 <- ggplot(x, aes(x = Date, y = value)) + geom_point(size = 0.5, alpha = 1/10) + theme_bw() + labs(title = "Trout Bog Hypolimnion", x = "Time Difference", y = "UniFrac Distance") + scale_x_continuous(breaks = c(365, 365*2, 365*3, 365*4)) + geom_smooth()
TBE <- prune_samples(sampledata$Bog == "TB" & sampledata$Layer == "E", alldata)
x <- UniFrac(TBE, weighted = T, normalize = T)
x <- melt(as.matrix(x))
x$Date <- as.numeric(abs(extract_date(x$Var1) - extract_date(x$Var2)))
x$Mon1 <- substr(x$Var1, start = 6, stop = 8)
x$Mon2 <- substr(x$Var2, start = 6, stop = 8)
colors <- rep("black", dim(x)[1])
p2 <- ggplot(x, aes(x = Date, y = value)) + geom_point(size = 0.5, alpha = 1/10) + theme_bw() + labs(title = "Trout Bog Epilimnion", x = "Time Difference", y = "UniFrac Distance") + scale_x_continuous(breaks = c(365, 365*2, 365*3, 365*4)) + geom_smooth()
MAH <- prune_samples(sampledata$Bog == "MA" & sampledata$Layer == "H", alldata)
x <- UniFrac(MAH, weighted = T, normalize = T)
x <- melt(as.matrix(x))
x$Date <- as.numeric(abs(extract_date(x$Var1) - extract_date(x$Var2)))
x <- x[which(x$Var1 != "MAH23OCT07.R1" & x$Var1 != "MAH30JUL07.R1" & x$Var2 != "MAH23OCT07.R1" & x$Var2 != "MAH30JUL07.R1" & x$Var1 != "MAH23OCT07.R2" & x$Var1 != "MAH30JUL07.R2" & x$Var2 != "MAH23OCT07.R2" & x$Var2 != "MAH30JUL07.R2"),]
p3 <- ggplot(x, aes(x = Date, y = value)) + geom_point(size = 0.5, alpha = 1/10) + theme_bw() + labs(title = "Mary Lake Hypolimnion", x = "Time Difference", y = "UniFrac Distance") + scale_x_continuous(breaks = c(365, 365*2, 365*3, 365*4)) + geom_smooth()
pdf(file = "C:/Users/Alex/Desktop/North_Temperate_Lakes-Microbial_Observatory/Plots/figure3.pdf", width = 3.3125*2, height = 7)
multiplot(p1, p2, p3, cols = 1)
dev.off()
